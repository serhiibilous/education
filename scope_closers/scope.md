## Область видимости (Scope)

**Область видимости** — это набор правил, которые определяют где и как переменная (идентификатор)
могут быть найдены.
Этот поиск может осуществляться для целей присваивания значения переменной,
или может осуществляться для целей извлечения ее значения.

Присваивания, связанные с **Областью видимости**, 
могут происходить либо с помощью операции ``=``, 
либо передачей аргументов (присваиванием) параметрам функции.

JavaScript Движок перед выполнением сначала компилирует код, 
и пока он это делает, он разбивает операторы, подобные ``var a = 2;`` 
на два отдельных шага:

Первый, ``var a``, чтобы объявить ее в Область видимости. 
Это выполняется в самом начале, до исполнения кода.

Позже, ``a = 2`` ищет переменную и присваивает ей значение, если находит.

Поиск переменной для определения и присваивания начинаются 
в текущей выполняющейся **Области видимости** 
и если нужно (т.е. они не нашли что искали в ней), 
они работают с их более высокими вложенными **Областями видимости**, 
с одной областью за раз (если их есть много), ища идентификатор, 
пока не доберутся до глобальной и не остановятся, 
вне зависимости от результата поиска.

Пример:
```
function printSum(passedVariable) {
    console.log( passedVariable + globalVariable );
}

var globalVariable = 10;

printSum( 10 );
```

Это пример **вложенной области видимости**. 
Что мы видим в этом здесь - когда мы вызываем функцию `printSum` с одним параметром, 
внутри нее происходит неявное объявление и 
присваивание параметру ``var a`` + ``a = 10``,
дальше когда мы выводим в консоль данные нам нужно значение переменной ``globalVariable``
Но так как в области видимости функции `printSum` нет переменной ``globalVariable``, 
то мы идем искать ее в область где объявлена наша функция 
(в этом конкретном случае это `глобальная область видимости`) 
и там есть наша искомая переменная.

Рассмотрим вариант когда переменная globalVariable 
объявлена в области видимости функции `printSum`:

```
function printSum(passedVariable) {
    var globalVariable = 5;
    console.log( passedVariable + globalVariable );
}

var globalVariable = 10;

printSum( 10 );
```

Сейчас когда мы обращаемся к переменной globalVariable 
мы так же начинаем искать ее в области видимости функции printSum,
И мы ее находим там и берем значение 
(игнорируя значение такой же переменной из глобальной области видимости)

## Область видимости у функций
В JavaScript есть области видимости в функциях. 
То есть, каждая функция, которую вы объявляете, 
создает зону для себя, но больше ни одна структура 
не создает свою собственную зону области видимости. 
Как мы скоро увидим, это не совсем правда.

### Особенность функций такова что можно прятать переменные и функции внутри функции.

Иными словами, вы можете "спрятать" переменные и функции 
заключив их в область видимости функции.

Этот принцип заявляет, что в дизайне ПО, 
таком как API для модуля/объекта, 
вам следует выставлять наружу только то, 
что минимально необходимо и "прятать" всё остальное.

## Функциональные выражения и их вызов.

Функциональное выражение - `(function foo(){ .. })`

И функция - `function foo(){ .. }`

Так же мы можем вызвать функциональное выражение по месту.

```js
var a = 2;

(function foo(){

	var a = 3;
	console.log( a ); // 3

})();

console.log( a ); // 2
```
Этот шаблон называется **IIFE**, что означает 
Immediately (немедленно) Invoked (вызываемое) 
Function (функциональное) Expression (выражение).


## Блоки как области видимости

Блочная область видимости в JavaScript 
представлена несколькими способами.

##`try/catch`

Например:
```js
try {
    undefined(); // нелегальная операция, чтобы вызвать исключение!
}
catch (err) {
    console.log( err ); // работает!
}

console.log( err ); // ReferenceError: `err` not found
```
Как видите, err существует только в блоке catch 
и выбрасывает ошибку когда вы пытаетесь сослаться 
на нее где-либо в другом месте.

##`let`

Ключевое слово let присоединяет объявление переменной к области видимости того блока (обычно пара `{ .. }`), 
в котором оно содержится. 
Иными словами, `let` неявно похищает у любой блочной области видимости ее объявления переменных.

```js
var foo = true;

if (foo) {
	let bar = foo * 2;
	bar = something( bar );
	console.log( bar );
}

console.log( bar ); // ReferenceError
```

##`const`

В дополнение к `let`, ES6 представляет ключевое слово `const`, 
которое также создает переменную блочной области видимости, 
но чье значение фиксированно (константа). 
Любая попытка изменить это значение позже приведет к ошибке.



## Основные принципы области видимости:
### И они же это ответы на вопросы на собеседовании

### Определение:

**Область видимости** — это набор правил, которые определяют где и как переменная (идентификатор)
могут быть найдены.
Этот поиск может осуществляться для целей присваивания значения переменной,
или может осуществляться для целей извлечения ее значения.

- область видимости (Лексическая) основана на том,
  где переменные и блоки области видимости были созданы вами во время написания
  и таким образом (в основном) навечно зафиксированы на момент,
  когда лексический анализатор обрабатывал ваш код.
  
- Поиск переменной для определения и присваивания начинаются в текущей выполняющейся **Области видимости**
  и если нужно (т.е. они не нашли что искали в ней),
  они работают с их более высокими вложенными **Областями видимости**,
  с одной областью за раз (если их есть много), ища идентификатор,
  пока не доберутся до глобальной и не остановятся, вне зависимости от результата поиска.
  
- Поиск в области видимости прекращается, как только он находит первое совпадение. 
  
- Глобальные переменные также автоматически являются свойствами глобального объекта 
  (window в браузерах и т.п.), поэтому можно ссылаться на глобальную переменную 
  не прямо по ее лексическому имени, а вместо этого косвенно использовать ссылку 
  на свойство глобального объекта. ``window.a``
  
- Не важно откуда вызывается функция или даже как она вызывается, 
  ее лексическая область видимости определена только тем, где функция была объявлена.
  
- Функции — самые распространенные единицы области видимости в JavaScript. 
  Переменные и функции, которые объявляются внутри другой функции, 
  по существу "скрыты" от любой из окружающих "областей видимости", 
  что является намеренным принципом разработки хорошего ПО.
  
- В ES6 представлено ключевое слово `let` (родственница ключевого слова `var`), 
  чтобы позволить объявления переменных в любом произвольном блоке кода. 
  `if (..) { let a = 2; }` объявит переменную `a`, 
  которая фактически похитит область видимости блока `{ .. }` в `if` и присоединит себя к ней.